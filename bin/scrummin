#! /usr/bin/env ruby

require "scrummin"

people = ARGV.map { |a| Scrummin::Person.new(a) }
meeting = Scrummin::Meeting.new(participants: people, track_group_chat: true)

puts "starting meeting with: #{meeting.participants.map(&:name).sort.join(', ')}"
puts "commands: (a)dd (n)ext (q)uit"

meeting.start

while meeting.active?
  print "> "
  case $stdin.gets.chomp
  when "a", "add"
    print "enter name> "
    name = $stdin.gets.chomp
    meeting << Scrummin::Person.new(name)
  when "n", "next"
    if person = meeting.next
      puts person.name
    else
      puts "done"
    end
  when "q", "quit"
    exit 1
  end
end

puts

calculator = Scrummin::Calculator.new(meeting)
puts "--------------"
puts "Total meeting duration: #{calculator.total_duration}s"
puts "Winning target: #{calculator.winning_target}s"
puts "--------------"
calculator.winners.each do |winner|
  puts "#{winner[:place]}: #{winner[:participant].name}, #{winner[:participant].duration}s"
end
